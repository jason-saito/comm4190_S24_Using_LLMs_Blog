<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jason Saito">
<meta name="dcterms.date" content="2024-03-21">
<meta name="description" content="Exploring Pegasus – Can it analyze basketball highlights?">

<title>My Explorations with LLMs - LLMs and Basketball Highlight Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Explorations with LLMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../interests.html"> 
<span class="menu-text">Interests</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jason-saito"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/jason-saito/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">LLMs and Basketball Highlight Analysis</h1>
                  <div>
        <div class="description">
          Exploring Pegasus – Can it analyze basketball highlights?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Basketball</div>
                <div class="quarto-category">Pegasus</div>
                <div class="quarto-category">Twelve Labs</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jason Saito </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 21, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>I was stumbling across YouTube when researching for my final project about the intersections of Sports Analytics and LLMs. I curious to see if there were any Generative AI tools out there that analyzed videos such as sports highlights, game summarys, etc. It turns out there was one tool called <a href="https://www.youtube.com/watch?v=Hrd11Tp72Y0"> “Pegasus” by Twelve Labs. </a></p>
<p>I decided to check it out further on their <a href="https://www.twelvelabs.io/blog/introducing-pegasus-1"> website </a> and was fascinated about their use of video to text and how it makes its outputs. I decided to test it out myself and made an account.</p>
<p>Immediately I was pleased to see the tool’s connection to sports, with its “stronger domain knowledge” for sports as well as its main features. <img src="index_files/figure-html/9fe68211-64a6-4d4b-b4a4-a56dd75cd0e5-2-cff928b7-3488-493a-9549-c63ce7f32e09.png" class="img-fluid" alt="image.png"> <img src="index_files/figure-html/9fe68211-64a6-4d4b-b4a4-a56dd75cd0e5-1-3b49e28d-bfc5-43db-a86b-4c85f6150e26.png" class="img-fluid" alt="image.png"></p>
</section>
<section id="testing-the-model" class="level1">
<h1>Testing the Model</h1>
<p>I wanted to see how well the model really understood sports and decided to provide it one of the most iconic moments in basketball history. Thankfully, the video includes the moment from multiple angles and lots of dialogue, that the model could hopefully pick up on and provide an analysis of.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.youtube.com/watch?v=nFQy-qmyotc"><img src="https://img.youtube.com/vi/nFQy-qmyotc/0.jpg" class="img-fluid figure-img" alt="Ray Allen’s Clutch Three"></a></p>
<figcaption>Ray Allen’s Clutch Three</figcaption>
</figure>
</div>
<p>After providing the YouTube link, it took a few minutes to process it.</p>
</section>
<section id="prompting" class="level1">
<h1>Prompting</h1>
<p>Once loaded, I prompted the model with the question, “Explain what’s happening in the video. For context, you’re watching a basketball game highlight. Explain the key words in basketball such as”rebound,” “3 pointer,” etc.</p>
</section>
<section id="response-1" class="level1">
<h1>Response #1</h1>
<p>LeBron’s Layup Tie: Miami Heat vs.&nbsp;San Antonio Spurs’ Intense Fourth Quarter with Ray Allen’s Game-Tying Three-Pointer</p>
<p>Topic:</p>
<p>Thrilling Basketball Playoffs Moment: LeBron James’ Game-Tying Layup by Ray Allen’s Historic Three-Point Shot.</p>
<p>Hashtags</p>
<p>#basketball #MiamiHeat #SanAntonioSpurs #LeBronJames #playoffgame #NBA #excitement</p>
<p>Summary</p>
<p>The video captures an intense moment from a basketball game between the Miami Heat and the San Antonio Spurs. The game is in the fourth quarter with the Heat leading by 3 points and 9 minutes and 11 seconds remaining on the clock. The focus is on the Heat’s LeBron James, number 34, who has the ball. LeBron skillfully maneuvers around a Spurs defender and makes a layup, scoring for the Heat. The crowd erupts in cheers as LeBron completes the basket, and his teammates on the bench join in the celebration. LeBron acknowledges the crowd with a raised fist, expressing triumph. The video showcases the athleticism and skill of the players, as well as the passion and engagement of the fans. Throughout the video, there are references to basketball terms such as rebound, three-pointer, and the history of three-point shooters in the NBA. This basketball game highlight captures the excitement and intensity of the sport.</p>
</section>
<section id="thoughts" class="level1">
<h1>Thoughts</h1>
<p>This output is not correct. The heat were actually down by 3 points with 9 seconds left to go. Ray Allen took a 3 pointer, not lebron taking a layup.</p>
<p>I re- attempted with the same prompt but with a lower temperature this time (to 0).</p>
</section>
<section id="response-2" class="level1">
<h1>Response #2</h1>
<p>Based on the visual information provided, the video is a basketball game highlight between the Miami Heat and the San Antonio Spurs. The footage captures a sequence of plays involving LeBron James (#34) from the Heat team. The game is in the fourth quarter, with the Heat leading by 3 points (89-86) and 9 minutes and 11 seconds remaining on the game clock. In terms of basketball terminology, the video showcases various key words and actions. These include: Rebound: This refers to the act of retrieving the ball after a missed shot. In the video, there are instances where players from both teams attempt to grab rebounds after missed shots. 3 pointer: A 3 pointer is a shot taken from beyond the three-point line, with the potential to score three points. The video captures moments where players attempt and make successful 3-point shots. Foul: A foul is a violation of the rules, often resulting in free throws for the opposing team. While the video does not explicitly show fouls, it is mentioned in the answer that potential fouls occur during the game. The base description provides additional context about the video. It mentions that the footage is taken from a high vantage point, likely from the upper level of the arena. The scoreboard indicates that the game is being broadcasted on ESPN and shows the score, time remaining, and team abbreviations. The description also highlights the excitement of the crowd and the intense atmosphere of a high-stakes playoff game. In summary, the video is a basketball game highlight showcasing LeBron James and featuring moments of rebounding, 3-point shots, and potential fouls. The base description provides further details about the game, the teams involved, and the overall atmosphere.</p>
</section>
<section id="thoughts-1" class="level1">
<h1>Thoughts</h1>
<p>This response is slightly better, it actually answered my question about basketball terminology as well as provided that the game was on ESPN. However, the score and the play are both not true.</p>
</section>
<section id="prompting-1" class="level1">
<h1>Prompting</h1>
<p>I tried it again with a temperature of 0.01.</p>
</section>
<section id="response-3" class="level1">
<h1>Response #3</h1>
<p>The video captures a thrilling moment from a basketball game between the Miami Heat and the San Antonio Spurs. The footage is taken from a high vantage point, providing a clear view of the court and the crowd. The game is in the fourth quarter with the Heat leading by 3 points, 89-86, with 9:11 remaining on the game clock. The focus is on the Heat’s number 34, LeBron James, who is in possession of the basketball. LeBron skillfully maneuvers around a Spurs defender and makes a layup, scoring for the Heat. The crowd erupts in cheers as LeBron completes the basket, and his teammates on the bench join in the celebration. The video showcases the intensity and excitement of professional basketball, highlighting the athleticism and skill of the players, as well as the passion and engagement of the fans.</p>
</section>
<section id="thoughts-2" class="level1">
<h1>Thoughts</h1>
<p>This response is still inaccurate. However, the “chapters” of the video are accurate. I’m not sure why it’s not able to summarize the video but can categorize the video into different sections.</p>
<section id="chapters" class="level4">
<h4 class="anchored" data-anchor-id="chapters">Chapters:</h4>
<ol type="1">
<li><p>Intense Playoff Game 00:00:00 - 00:00:09 The video captures a thrilling moment from a basketball game between the Miami Heat and the San Antonio Spurs, as indicated by the team abbreviations ‘MIA’ and ‘SAS’ displayed on the scoreboard. The footage is taken from a high vantage point, likely from the upper level of the arena, providing a clear view of the court and the crowd. The scoreboard shows that the game is in the fourth quarter with the Heat leading by 3 points, 89-86, with 9:11 remaining on the game clock. The scoreboard also displays the ‘ESPN’ logo, suggesting that the game is being broadcasted on ESPN.</p></li>
<li><p>LeBron’s Incredible Shot 00:00:10 - 00:00:30 As LeBron approaches the basket, he is met by a Spurs defender who attempts to block his shot. LeBron skillfully maneuvers around the defender and makes a layup, scoring for the Heat. The crowd erupts in cheers as LeBron completes the basket, and his teammates on the bench join in the celebration.</p></li>
<li><p>Ray Allen’s Game-Tying Three 00:00:34 - 00:00:48 Ray Allen hit a huge three-pointer to tie the game. He backed up behind the three-point line as he caught the pass and then came right back into the shot. The crowd goes wild as the game is now tied.</p></li>
</ol>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Overall, I think the model is solid. It does a good job summarizing the video through chapters but is not able to tell me key details about the video such as what shot he took, the time left in the game, and who shot the ball. I hope to try the model with other sports to see how it performs.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jason-saito\.github\.io\/comm4190_S24_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>